{"version":3,"file":"static/webpack/static/development/pages/detail.js.3735a0b6259d118a5188.hot-update.js","sources":["webpack:///./src/components/detail/detail.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport Router from \"next/router\";\nimport { withRouter } from \"next/router\";\n\nimport { setRestaurants } from \"../../actions\";\nimport PopIn from \"./pop-in\";\nimport TopSection from \"./top-section\";\nimport MiddleSection from \"./middle-section\";\nimport BottomSection from \"./bottom-section\";\nimport Footer from \"./footer\";\n\nconst Detail = props => {\n  const { setRestaurants, restaurants, match, router } = props;\n  const [restaurant, setRestaurant] = useState({})\n  const [hasSeenSuggestion, setHasSeenSuggestion] = useState(false)\n  const [similarRestaurants, setSimilarRestaurants] = useState([])\n  const nextRestaurantRef = useRef(null);\n  const previousRestaurantRef = useRef(null);\n  const detailPageTop = useRef(null);\n  const listedRestaurants = router.query.listedRestaurants;\n  \n  const setNavigation = restaurantList => {\n    let previous;\n    let next;\n\n    restaurantList.forEach((val, i) => {\n      if (val.id.toString() === match.params.id) {\n        previous = restaurantList[i - 1];\n        next = restaurantList[i + 1];\n      };\n    });\n\n    if (previous) {\n      previousRestaurantRef.current = previous.id;\n    } else previousRestaurantRef.current = null;\n    if (next) {\n      nextRestaurantRef.current = next.id;\n    } else nextRestaurantRef.current = null;\n  };\n\n  const scrollToTop = () => {\n    detailPageTop.current.scrollIntoView();\n  }\n\n  // if a user arrives on the pageId directly \n  // he doesn't get the restaurantS or listedRestaurantS objects in the props\n  useEffect(() => { \n    if (!router.query.restaurant) {\n      setRestaurants(); \n    }\n  }, [router.query.restaurant, setRestaurants]);\n\n  useEffect(() => {\n    if (router.query.listedRestaurants) {\n      setNavigation(router.query.listedRestaurants);\n    } else {\n      setNavigation(restaurants);\n    };\n\n    if (router.query.restaurant) {\n      setRestaurant(router.query.restaurant);\n      const filterByType = [...restaurants].filter(val => {\n        if (val.type && val.name !== router.query.restaurant.name) {\n          return val.type === router.query.restaurant.type;\n        } else return null;\n      });\n  \n      setSimilarRestaurants(filterByType.slice(0, 9));\n    } else {\n      const detailRestaurant = [...restaurants].filter(val => {\n        if (val.id) {\n          return val.id.toString() === match.params.id;\n        } else return null;\n      });\n  \n      setRestaurant(detailRestaurant[0]);\n\n      const filterByType = [...restaurants].filter(val => {\n        if (val.type && val.name !== detailRestaurant[0].name) {\n          return val.type === detailRestaurant[0].type;\n        } else return null;\n      });\n  \n      setSimilarRestaurants(filterByType.slice(0, 9));\n    };\n  // eslint-disable-next-line\n  }, [router.query.restaurant, restaurants, match.params.id]);\n\n  const handleKeyDown = e => {\n    // 37 arrow left / 39 arrow right\n    if (e.keyCode === 37) {\n      if (previousRestaurantRef.current) {\n        Router.push({ pathname: `/detail/${previousRestaurantRef.current}`, query: { listedRestaurants } });\n      };\n    } else if (e.keyCode === 39) {\n      if (nextRestaurantRef.current) {\n        Router.push({ pathname: `/detail/${nextRestaurantRef.current}`, query: { listedRestaurants } });\n      };\n    };\n\n    scrollToTop();\n  };\n\n  const handleNavigation = (direction, id) => {\n    if (direction === \"left\") {\n      if (previousRestaurantRef.current) {\n        Router.push({ pathname: `/detail/${previousRestaurantRef.current}`, query: { listedRestaurants } });\n      };\n    } else if (direction === \"next-page\") {\n      Router.push({ pathname: `/detail/${id}`, query: { listedRestaurants } });\n    } else if (direction === \"right\") {\n      if (nextRestaurantRef.current) {\n        Router.push({ pathname: `/detail/${nextRestaurantRef.current}`, query: { listedRestaurants } });\n      };\n    };\n\n    scrollToTop();\n  };\n\n  useEffect(() => { \n    window.addEventListener(\"keydown\", handleKeyDown, true);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown, true);\n  // eslint-disable-next-line\n  }, []);\n\n  useEffect(() => {\n    const disclaimer = localStorage.getItem('has_seen_suggestion');\n    disclaimer ? setHasSeenSuggestion(true) : setHasSeenSuggestion(false);\n  }, []);\n\n  return restaurant ? (\n    <>\n      <div className=\"detail-page-wrapper\">\n        <PopIn \n          setHasSeenSuggestion={setHasSeenSuggestion}\n          hasSeenSuggestion={hasSeenSuggestion}\n        />\n        <TopSection\n          history={Router}\n          restaurant={restaurant}\n          location={router.query}\n          detailPageTop={detailPageTop}\n        />\n        <MiddleSection location={router.query} restaurant={restaurant} />\n        <BottomSection\n          similarRestaurants={similarRestaurants}\n          handleNavigation={handleNavigation}\n        />\n      </div>\n      <Footer\n        handleNavigation={handleNavigation}\n        previousRestaurantRef={previousRestaurantRef}\n        nextRestaurantRef={nextRestaurantRef}\n        hasSeenSuggestion={hasSeenSuggestion}\n      />\n    </>\n  ) :\n  <div>no restaurant corresponding</div>\n};\n\nconst mapStateToProps = state => {\n  return {\n    restaurants: state.restaurants,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators({ setRestaurants }, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(Detail));\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AACA;AACA;AADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AACA;AACA;AADA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AAEA;AACA;AAFA;AAKA;AACA;AACA;AACA;AAJA;AAMA;AAAA;AAAA;AAEA;AACA;AAFA;AAMA;AACA;AACA;AACA;AAJA;AASA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;;;;A","sourceRoot":""}