{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport Router from \"next/router\";\nimport { withRouter } from \"next/router\";\nimport { setRestaurants } from \"../../actions\";\n\nconst DetailMobile = props => {\n  const {\n    setRestaurants,\n    restaurants,\n    match,\n    router\n  } = props;\n  const {\n    0: restaurant,\n    1: setRestaurant\n  } = useState({});\n  const {\n    0: similarRestaurants,\n    1: setSimilarRestaurants\n  } = useState([]);\n  const nextRestaurantRef = useRef(null);\n  const previousRestaurantRef = useRef(null);\n  const detailPageTop = useRef(null);\n  const listedRestaurants = router.query.listedRestaurants;\n\n  const scrollToDetailTop = () => {\n    detailPageTop.current.scrollIntoView();\n  };\n\n  const setNavigation = restaurantList => {\n    let previous;\n    let next;\n    restaurantList.forEach((val, i) => {\n      if (val.id.toString() === match.params.id) {\n        previous = restaurantList[i - 1];\n        next = restaurantList[i + 1];\n      }\n\n      ;\n    });\n\n    if (previous) {\n      previousRestaurantRef.current = previous.id;\n    }\n\n    ;\n\n    if (next) {\n      nextRestaurantRef.current = next.id;\n    }\n\n    ;\n  }; // if a user arrives on the pageId directly \n  // he doesn't get the restaurant object in the props so we execute these 2 hooks\n\n\n  useEffect(() => {\n    if (!router.query.restaurant) {\n      setRestaurants();\n    }\n\n    ;\n  }, [router.query.restaurant, setRestaurants]);\n  useEffect(() => {\n    if (router.query.listedRestaurants) {\n      setNavigation(router.query.listedRestaurants);\n    } else {\n      //\n      setNavigation(restaurants);\n    }\n\n    ;\n\n    if (router.query.restaurant) {\n      setRestaurant(router.query.restaurant);\n      const filterByType = [...restaurants].filter(val => {\n        if (val.type && val.name !== router.query.restaurant.name) {\n          return val.type === router.query.restaurant.type;\n        } else return null;\n      });\n      setSimilarRestaurants(filterByType.slice(0, 6));\n    } else {\n      const detailRestaurant = [...restaurants].filter(val => {\n        if (val.id) {\n          return val.id.toString() === match.params.id;\n        } else return null;\n      });\n      setRestaurant(detailRestaurant[0]);\n      const filterByType = [...restaurants].filter(val => {\n        if (val.type && val.name !== detailRestaurant[0].name) {\n          return val.type === detailRestaurant[0].type;\n        } else return null;\n      });\n      setSimilarRestaurants(filterByType.slice(0, 6));\n    }\n\n    ; // eslint-disable-next-line\n  }, [router.query.restaurant, restaurants, match.params.id]); // go to top because it keeps the same scroll position as the previous page\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  const handleNavigation = (direction, id) => {\n    if (direction === \"left\") {\n      if (previousRestaurantRef.current) {\n        Router.push({\n          pathname: `/detail/${previousRestaurantRef.current}`,\n          query: {\n            listedRestaurants\n          }\n        });\n      }\n\n      ;\n    } else if (direction === \"next-page\") {\n      Router.push({\n        pathname: `/detail/${id}`,\n        query: {\n          listedRestaurants\n        }\n      });\n    } else if (direction === \"right\") {\n      if (nextRestaurantRef.current) {\n        Router.push({\n          pathname: `/detail/${nextRestaurantRef.current}`,\n          query: {\n            listedRestaurants\n          }\n        });\n      }\n\n      ;\n    }\n\n    ;\n    scrollToDetailTop();\n  };\n\n  return restaurant ? __jsx(\"div\", {\n    className: \"detail-page-wrapper-mobile\"\n  }, __jsx(\"div\", {\n    className: \"button-go-back\",\n    onClick: () => Router.back()\n  }, __jsx(\"i\", {\n    className: \"fas fa-chevron-left\"\n  }), \" Retour\"), restaurant.award && __jsx(\"div\", {\n    className: \"detail-page-award\"\n  }, restaurant.award.description), __jsx(\"div\", {\n    className: \"detail-page-big-img\",\n    style: {\n      backgroundImage: `url(${restaurant.imageUrl})`,\n      backgroundPosition: \"center\",\n      backgroundSize: \"cover\"\n    }\n  }), __jsx(\"div\", {\n    key: router.pathname,\n    className: \"detail-page-content\"\n  }, __jsx(\"div\", {\n    className: \"detail-page-title\"\n  }, restaurant.name), __jsx(\"ul\", {\n    className: \"detail-page-resume\"\n  }, __jsx(\"li\", null, __jsx(\"span\", {\n    className: \"bolder\"\n  }, \"Type :\"), \" \", restaurant.type, \" (\", restaurant.price, \")\"), __jsx(\"li\", null, __jsx(\"span\", {\n    className: \"bolder\"\n  }, \"Note :\"), \" \", restaurant.rate, \"/5 (+ de \", restaurant.votes, \" votes Google)\"), __jsx(\"li\", null, restaurant.address), __jsx(\"li\", null, __jsx(\"span\", {\n    className: \"bolder\"\n  }, \"Horaires :\"), \" \", restaurant.openingHours), __jsx(\"li\", null, __jsx(\"span\", {\n    className: \"bolder\"\n  }, \"T\\xE9l\\xE9phone :\"), \" \", restaurant.phone || \"Non communiqué\"), __jsx(\"li\", null, __jsx(\"a\", {\n    href: restaurant.menuLink,\n    target: \"_blank\",\n    className: \"see-menu\",\n    rel: \"noopener noreferrer\"\n  }, \"Voir le menu\")))), __jsx(\"div\", {\n    className: \"detail-page-reviews\"\n  }, __jsx(\"div\", {\n    className: \"foodlab-review\"\n  }, __jsx(\"div\", {\n    className: \"foodlab-review-title\"\n  }, \"Avis FoodLab : \"), restaurant.foodlabreview ? `« ${restaurant.foodlabreview} »` : \"Rédaction en cours\"), __jsx(\"ul\", {\n    className: \"customers-reviews\"\n  }, restaurant.reviews ? restaurant.reviews.map((review, i) => {\n    return __jsx(\"li\", {\n      key: i\n    }, __jsx(\"div\", {\n      className: \"review-date\"\n    }, \"Review utilisateur \", i + 1, \" - le \", review.date, \" :\"), __jsx(\"div\", {\n      className: \"review-comment\"\n    }, \"\\\"\", review.comment, \"\\\"\"));\n  }) : __jsx(\"li\", null, \"Pas de reviews enregistr\\xE9es\"))), restaurant.imageUrl2 && __jsx(\"div\", {\n    className: \"detail-page-cropped-img\",\n    style: {\n      backgroundImage: `url(${restaurant.imageUrl2})`,\n      backgroundPosition: \"right\",\n      backgroundSize: \"cover\"\n    }\n  }), similarRestaurants.length > 0 && __jsx(\"div\", {\n    className: \"bottom-section\"\n  }, __jsx(\"div\", {\n    className: \"bottom-section-title\"\n  }, \"Restaurants similaires :\"), __jsx(\"div\", {\n    className: \"similar-restaurants-wrapper\"\n  }, similarRestaurants.map(simRest => {\n    return __jsx(\"div\", {\n      className: \"similar-restaurant-card\",\n      key: simRest.id,\n      onClick: () => handleNavigation(\"next-page\", simRest.id)\n    }, __jsx(\"div\", {\n      className: \"similar-restaurant-description\"\n    }, __jsx(\"div\", {\n      className: \"similar-restaurant-card-name\"\n    }, simRest.name), __jsx(\"div\", {\n      className: \"similar-restaurant-card-rate\"\n    }, simRest.rate, \"/5 (\", simRest.votes, \"+ votes)\"), __jsx(\"div\", {\n      className: \"similar-restaurant-card-address\"\n    }, simRest.address)), __jsx(\"div\", {\n      className: \"similar-restaurant-image\"\n    }, __jsx(\"img\", {\n      src: simRest.imageUrl,\n      alt: \"similar-restaurant\"\n    })));\n  }))), __jsx(\"div\", {\n    className: \"detail-page-footer\"\n  }, __jsx(\"div\", {\n    className: \"footer-button-left\",\n    onClick: () => handleNavigation(\"left\")\n  }, __jsx(\"i\", {\n    className: \"fas fa-chevron-left\"\n  })), __jsx(\"div\", {\n    className: \"footer-text\"\n  }), __jsx(\"div\", {\n    className: \"footer-button-right\",\n    onClick: () => handleNavigation(\"right\")\n  }, __jsx(\"i\", {\n    className: \"fas fa-chevron-right\"\n  })))) : __jsx(\"div\", null, \"no restaurant corresponding\");\n};\n\nconst mapStateToProps = state => {\n  return {\n    restaurants: state.restaurants\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators({\n    setRestaurants\n  }, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(DetailMobile));","map":{"version":3,"sources":["/Users/estellegresillon/Code/airbnb-redux/src/components/detail/detail-mobile.jsx"],"names":["React","useState","useEffect","useRef","connect","bindActionCreators","Router","withRouter","setRestaurants","DetailMobile","props","restaurants","match","router","restaurant","setRestaurant","similarRestaurants","setSimilarRestaurants","nextRestaurantRef","previousRestaurantRef","detailPageTop","listedRestaurants","query","scrollToDetailTop","current","scrollIntoView","setNavigation","restaurantList","previous","next","forEach","val","i","id","toString","params","filterByType","filter","type","name","slice","detailRestaurant","window","scrollTo","handleNavigation","direction","push","pathname","back","award","description","backgroundImage","imageUrl","backgroundPosition","backgroundSize","price","rate","votes","address","openingHours","phone","menuLink","foodlabreview","reviews","map","review","date","comment","imageUrl2","length","simRest","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport Router from \"next/router\";\nimport { withRouter } from \"next/router\";\n\nimport { setRestaurants } from \"../../actions\";\n\nconst DetailMobile = props => {\n  const { setRestaurants, restaurants, match, router } = props;\n  const [restaurant, setRestaurant] = useState({});\n  const [similarRestaurants, setSimilarRestaurants] = useState([]);\n  const nextRestaurantRef = useRef(null);\n  const previousRestaurantRef = useRef(null);\n  const detailPageTop = useRef(null);\n  const listedRestaurants = router.query.listedRestaurants;\n\n  const scrollToDetailTop = () => {\n    detailPageTop.current.scrollIntoView();\n  }\n\n  const setNavigation = restaurantList => {\n    let previous;\n    let next;\n\n    restaurantList.forEach((val, i) => {\n      if (val.id.toString() === match.params.id) {\n        previous = restaurantList[i - 1];\n        next = restaurantList[i + 1];\n      };\n    });\n\n    if (previous) {\n      previousRestaurantRef.current = previous.id;\n    };\n    if (next) {\n      nextRestaurantRef.current = next.id;\n    };\n  };\n  \n  // if a user arrives on the pageId directly \n  // he doesn't get the restaurant object in the props so we execute these 2 hooks\n  useEffect(() => { \n    if (!router.query.restaurant) {\n      setRestaurants(); \n    };\n  }, [router.query.restaurant, setRestaurants]);\n\n  useEffect(() => {\n    if (router.query.listedRestaurants) {\n      setNavigation(router.query.listedRestaurants);\n    } else {//\n      setNavigation(restaurants);\n    };\n\n    if (router.query.restaurant) {\n      setRestaurant(router.query.restaurant);\n\n      const filterByType = [...restaurants].filter(val => {\n        if (val.type && val.name !== router.query.restaurant.name) {\n          return val.type === router.query.restaurant.type;\n        } else return null;\n      });\n  \n      setSimilarRestaurants(filterByType.slice(0, 6));\n    } else {\n      const detailRestaurant = [...restaurants].filter(val => {\n        if (val.id) {\n          return val.id.toString() === match.params.id;\n        } else return null;\n      });\n  \n      setRestaurant(detailRestaurant[0]);\n\n      const filterByType = [...restaurants].filter(val => {\n        if (val.type && val.name !== detailRestaurant[0].name) {\n          return val.type === detailRestaurant[0].type;\n        } else return null;\n      });\n  \n      setSimilarRestaurants(filterByType.slice(0, 6));\n    };\n  // eslint-disable-next-line\n  }, [router.query.restaurant, restaurants, match.params.id]);\n\n  // go to top because it keeps the same scroll position as the previous page\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  const handleNavigation = (direction, id) => {\n    if (direction === \"left\") {\n      if (previousRestaurantRef.current) {\n        Router.push({ pathname: `/detail/${previousRestaurantRef.current}`, query: { listedRestaurants } });\n      };\n    } else if (direction === \"next-page\") {\n      Router.push({ pathname: `/detail/${id}`, query: { listedRestaurants } });\n    } else if (direction === \"right\") {\n      if (nextRestaurantRef.current) {\n        Router.push({ pathname: `/detail/${nextRestaurantRef.current}`, query: { listedRestaurants } });\n      };\n    };\n\n    scrollToDetailTop();\n  };\n\n  return restaurant ? (\n    <div className=\"detail-page-wrapper-mobile\">\n      <div className=\"button-go-back\" onClick={() => Router.back()}>\n        <i className=\"fas fa-chevron-left\" /> Retour\n      </div>\n      {restaurant.award &&\n        <div className=\"detail-page-award\">\n          {restaurant.award.description}\n        </div>}\n      <div \n        className=\"detail-page-big-img\"\n        style={{ \n          backgroundImage: `url(${restaurant.imageUrl})`,\n          backgroundPosition: \"center\",\n          backgroundSize: \"cover\",\n        }}\n      />\n      <div key={router.pathname} className=\"detail-page-content\">\n        <div className=\"detail-page-title\">{restaurant.name}</div>\n        <ul className=\"detail-page-resume\">\n          <li><span className=\"bolder\">Type :</span> {restaurant.type} ({restaurant.price})</li>\n          <li><span className=\"bolder\">Note :</span> {restaurant.rate}/5 (+ de {restaurant.votes} votes Google)</li>\n          <li>{restaurant.address}</li>\n          <li><span className=\"bolder\">Horaires :</span> {restaurant.openingHours}</li>\n          <li><span className=\"bolder\">Téléphone :</span> {restaurant.phone || \"Non communiqué\"}</li>\n          <li>\n            <a \n              href={restaurant.menuLink}\n              target=\"_blank\"\n              className=\"see-menu\"\n              rel=\"noopener noreferrer\"\n            >Voir le menu</a>\n          </li>\n        </ul>\n      </div>\n      <div className=\"detail-page-reviews\">\n        <div className=\"foodlab-review\">\n          <div className=\"foodlab-review-title\">Avis FoodLab : </div>\n          {restaurant.foodlabreview ? `« ${restaurant.foodlabreview} »` : \"Rédaction en cours\"}\n        </div>\n        <ul className=\"customers-reviews\">\n          {restaurant.reviews ? restaurant.reviews.map((review, i) => {\n            return (\n              <li key={i}>\n          <div className=\"review-date\">Review utilisateur {i + 1} - le {review.date} :</div>\n                <div className=\"review-comment\">\"{review.comment}\"</div>\n              </li>\n            )\n          }) : <li>Pas de reviews enregistrées</li>}\n        </ul>\n      </div>\n      {restaurant.imageUrl2 && \n        <div \n          className=\"detail-page-cropped-img\"\n          style={{ \n            backgroundImage: `url(${restaurant.imageUrl2})`,\n            backgroundPosition: \"right\",\n            backgroundSize: \"cover\",\n          }}\n        />}\n      {similarRestaurants.length > 0 &&\n        <div className=\"bottom-section\">\n          <div className=\"bottom-section-title\">Restaurants similaires :</div>\n          <div className=\"similar-restaurants-wrapper\">\n            {similarRestaurants.map(simRest => {\n              return (\n                <div \n                  className=\"similar-restaurant-card\"\n                  key={simRest.id}\n                  onClick={() => handleNavigation(\"next-page\", simRest.id)}\n                >\n                  <div className=\"similar-restaurant-description\">\n                    <div className=\"similar-restaurant-card-name\">{simRest.name}</div>\n                    <div className=\"similar-restaurant-card-rate\">{simRest.rate}/5 ({simRest.votes}+ votes)</div>\n                    <div className=\"similar-restaurant-card-address\">{simRest.address}</div>\n                  </div>\n                  <div className=\"similar-restaurant-image\">\n                    <img src={simRest.imageUrl} alt=\"similar-restaurant\" />\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        </div>}\n      <div className=\"detail-page-footer\">\n        <div \n          className=\"footer-button-left\"\n          onClick={() => handleNavigation(\"left\")}\n        >\n          <i className=\"fas fa-chevron-left\" />\n        </div>\n        <div className=\"footer-text\"></div>\n        <div \n          className=\"footer-button-right\"\n          onClick={() => handleNavigation(\"right\")}\n        >\n          <i className=\"fas fa-chevron-right\" />\n        </div>\n      </div>\n    </div>\n  ) :\n  <div>no restaurant corresponding</div>\n};\n\nconst mapStateToProps = state => {\n  return {\n    restaurants: state.restaurants,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators({ setRestaurants }, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(DetailMobile));\n"]},"metadata":{},"sourceType":"module"}